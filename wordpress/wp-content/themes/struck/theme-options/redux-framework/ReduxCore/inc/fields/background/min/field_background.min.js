!function(e){"use strict";e.reduxBackground=e.reduxBackground||{},e(document).ready(function(){e.reduxBackground.init()}),e.reduxBackground.init=function(i){i||(i=e(document).find(".redux-container-background")),e(i).find(".redux-remove-background").unbind("click").on("click",function(i){return i.preventDefault(),e.reduxBackground.removeImage(e(this).parents(".redux-container-background:first")),e.reduxBackground.preview(e(this)),!1}),e(i).find(".redux-background-upload").unbind().on("click",function(i){e.reduxBackground.addImage(i,e(this).parents(".redux-container-background:first"))}),e(i).find(".redux-background-input").on("change",function(){e.reduxBackground.preview(e(this))}),e(i).find(".redux-color").wpColorPicker({change:function(i,n){redux_change(e(this)),e("#"+i.target.id+"-transparency").removeAttr("checked"),e(this).val(n.color.toString()),e.reduxBackground.preview(e(this))}})},e.reduxBackground.preview=function(i){var n=e(i).parents(".redux-container-background:first"),d=e(n).find(".background-preview");if(d){var r=!0,a=n.data("id")+"][",t="height:"+d.height()+"px;";e(n).find(".redux-background-input").each(function(){var i=e(this).serializeArray();i=i[0],i&&-1!=i.name.indexOf("[background-")&&""!==i.value&&(r=!1,i.name=i.name.split(a),i.name=i.name[1].replace("]",""),t+="background-image"==i.name?i.name+':url("'+i.value+'");':i.name+":"+i.value+";")}),r?d.slideUp():d.attr("style",t).fadeIn()}},e.reduxBackground.addImage=function(i,n){i.preventDefault();var d,r=e(this);return d?(d.open(),void 0):(d=wp.media({multiple:!1,library:{},title:r.data("choose"),button:{text:r.data("update")}}),d.on("select",function(){var i=d.state().get("selection").first();if(d.close(),"image"===i.attributes.type){n.find(".upload").val(i.attributes.url),n.find(".upload-id").val(i.attributes.id),n.find(".upload-height").val(i.attributes.height),n.find(".upload-width").val(i.attributes.width),redux_change(e(n).find(".upload-id"));var r=i.attributes.url;if("undefined"!=typeof i.attributes.sizes&&"undefined"!=typeof i.attributes.sizes.thumbnail)r=i.attributes.sizes.thumbnail.url;else if("undefined"!=typeof i.attributes.sizes){var a=i.attributes.height;for(var t in i.attributes.sizes){var u=i.attributes.sizes[t];u.height<a&&(a=u.height,r=u.url)}}else r=i.attributes.icon;n.find(".upload-thumbnail").val(r),n.find(".upload").hasClass("noPreview")||n.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+r+'">').slideDown("fast"),n.find(".redux-remove-background").removeClass("hide"),n.find(".redux-background-input-properties").slideDown(),e.reduxBackground.preview(n.find(".upload"))}}),d.open(),void 0)},e.reduxBackground.removeImage=function(i){if(i.find(".redux-remove-background").addClass("hide")){i.find(".redux-remove-background").addClass("hide"),i.find(".upload").val(""),i.find(".upload-id").val(""),i.find(".upload-height").val(""),i.find(".upload-width").val(""),redux_change(e(i).find(".upload-id")),i.find(".redux-background-input-properties").hide();var n=i.find(".screenshot");n.slideUp(),i.find(".remove-file").unbind(),e(".section-upload .upload-notice").length>0&&e(".redux-background-upload").remove()}}}(jQuery);